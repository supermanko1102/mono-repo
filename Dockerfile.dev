FROM node:22-bookworm-slim

WORKDIR /app

RUN corepack enable

# Install dependencies first (workspace install)
COPY package.json pnpm-workspace.yaml pnpm-lock.yaml ./
COPY frontend/package.json ./frontend/package.json
COPY backend/package.json ./backend/package.json

RUN pnpm install --frozen-lockfile

# Copy the rest of the monorepo
COPY . .

EXPOSE 3000
EXPOSE 4000
